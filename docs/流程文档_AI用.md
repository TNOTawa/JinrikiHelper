# è¯­éŸ³æ•°æ®é›†å¤„ç†å·¥å…· - æµç¨‹æ–‡æ¡£ ï¼ˆAIç”¨ï¼‰

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº [xszqxszq/auto-voice-bank](https://github.com/xszqxszq/auto-voice-bank) å¼€å‘çš„è¯­éŸ³æ•°æ®é›†å¤„ç†å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–åˆ¶ä½œè¯­éŸ³éŸ³æºåº“ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬éŸ³é¢‘åˆ‡ç‰‡ã€è¯­éŸ³è¯†åˆ«ã€å¼ºåˆ¶å¯¹é½å’ŒéŸ³æºå¯¼å‡ºã€‚

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Web UI ç•Œé¢ (gui.py)                         â”‚
â”‚                    åŸºäº Gradio 6.2.0 æ„å»º                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ¨¡å‹ä¸‹è½½é¡µ   â”‚  â”‚  åˆ¶ä½œéŸ³æºé¡µ   â”‚  â”‚     å¯¼å‡ºéŸ³æºé¡µ        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµæ°´çº¿æ ¸å¿ƒ (pipeline.py)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  VoiceBankPipeline - éŸ³æºåˆ¶ä½œæµæ°´çº¿                        â”‚   â”‚
â”‚  â”‚  â€¢ step0_preprocess() - VADåˆ‡ç‰‡ + Whisperè½¬å½•             â”‚   â”‚
â”‚  â”‚  â€¢ step1_mfa_align()  - MFAè¯­éŸ³å¯¹é½                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Silero VAD     â”‚  â”‚  Whisper ASR    â”‚  â”‚  MFA å¯¹é½å¼•æ“    â”‚
â”‚  è¯­éŸ³æ´»åŠ¨æ£€æµ‹    â”‚  â”‚  è¯­éŸ³è¯†åˆ«       â”‚  â”‚  (å¤–æŒ‚æ¨¡å¼)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç›®å½•ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ main.py                 # ç¨‹åºå…¥å£ (Web UI)
â”œâ”€â”€ main_local.py           # æœ¬åœ°æ¡Œé¢å…¥å£ (CustomTkinter GUI)
â”œâ”€â”€ config.json             # å…¨å±€é…ç½®æ–‡ä»¶
â”œâ”€â”€ bank/                   # éŸ³æºåº“ç›®å½•
â”‚   â””â”€â”€ [éŸ³æºåç§°]/
â”‚       â”œâ”€â”€ meta.json       # éŸ³æºå…ƒä¿¡æ¯
â”‚       â”œâ”€â”€ slices/         # åˆ‡ç‰‡æ–‡ä»¶ (.wav + .lab)
â”‚       â””â”€â”€ textgrid/       # MFAå¯¹é½ç»“æœ (.TextGrid)
â”œâ”€â”€ export/                 # å¯¼å‡ºç›®å½•
â”‚   â””â”€â”€ [éŸ³æºåç§°]/
â”‚       â””â”€â”€ simple_export/  # ç®€å•å¯¼å‡ºç»“æœ
â”œâ”€â”€ models/                 # æ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ mfa/                # MFAå£°å­¦æ¨¡å‹å’Œå­—å…¸
â”‚   â”œâ”€â”€ silero_vad/         # Silero VADæ¨¡å‹
â”‚   â””â”€â”€ whisper/            # Whisperæ¨¡å‹ç¼“å­˜
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ mfa_engine/         # MFAç‹¬ç«‹è¿è¡Œç¯å¢ƒ (Sidecar)
â””â”€â”€ src/                    # æºä»£ç ç›®å½•
    â”œâ”€â”€ gui.py              # Web UI (Gradio 6.2.0)
    â”œâ”€â”€ gui_old.py          # æ—§ç‰ˆæ¡Œé¢ GUI (CustomTkinter)
    â”œâ”€â”€ pipeline.py         # æµæ°´çº¿æ ¸å¿ƒ
    â”œâ”€â”€ audio_processor.py  # éŸ³é¢‘å¤„ç†
    â”œâ”€â”€ text_processor.py   # æ–‡æœ¬å¤„ç†
    â”œâ”€â”€ mfa_runner.py       # MFAå¯¹é½è¿è¡Œå™¨
    â”œâ”€â”€ mfa_model_downloader.py    # MFAæ¨¡å‹ä¸‹è½½
    â”œâ”€â”€ silero_vad_downloader.py   # VADæ¨¡å‹ä¸‹è½½
    â””â”€â”€ export_plugins/     # å¯¼å‡ºæ’ä»¶ç›®å½•
```

## æ ¸å¿ƒæµç¨‹

### å®Œæ•´åˆ¶ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           éŸ³æºåˆ¶ä½œå®Œæ•´æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥: åŸå§‹éŸ³é¢‘æ–‡ä»¶ (.wav/.mp3/.flac/.ogg/.m4a)
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤0: éŸ³é¢‘é¢„å¤„ç† (step0_preprocess)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. Silero VAD è¯­éŸ³æ´»åŠ¨æ£€æµ‹                                           â”‚ â”‚
â”‚ â”‚    â€¢ åŠ è½½ ONNX æ ¼å¼ VAD æ¨¡å‹                                         â”‚ â”‚
â”‚ â”‚    â€¢ æ£€æµ‹è¯­éŸ³ç‰‡æ®µæ—¶é—´æˆ³                                              â”‚ â”‚
â”‚ â”‚    â€¢ æŒ‰è¯­éŸ³ç‰‡æ®µåˆ‡åˆ†éŸ³é¢‘                                              â”‚ â”‚
â”‚ â”‚    â€¢ è¾“å‡º: 16bit 44.1kHz å•å£°é“ WAV                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 2. Whisper è¯­éŸ³è¯†åˆ«                                                  â”‚ â”‚
â”‚ â”‚    â€¢ åŠ è½½ Whisper æ¨¡å‹ (small/medium)                                â”‚ â”‚
â”‚ â”‚    â€¢ å¯¹æ¯ä¸ªåˆ‡ç‰‡è¿›è¡Œè½¬å½•                                              â”‚ â”‚
â”‚ â”‚    â€¢ ç”Ÿæˆå¯¹åº”çš„ .lab æ ‡æ³¨æ–‡ä»¶                                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚ è¾“å‡º: bank/[éŸ³æºåç§°]/slices/                                           â”‚
â”‚       â”œâ”€â”€ test_0000.wav                                                 â”‚
â”‚       â”œâ”€â”€ test_0000.lab  (ä¸­æ–‡æ–‡æœ¬)                                     â”‚
â”‚       â”œâ”€â”€ test_0001.wav                                                 â”‚
â”‚       â””â”€â”€ test_0001.lab                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: MFAè¯­éŸ³å¯¹é½ (step1_mfa_align)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Montreal Forced Aligner                                              â”‚ â”‚
â”‚ â”‚    â€¢ ä½¿ç”¨å¤–æŒ‚æ¨¡å¼è°ƒç”¨ tools/mfa_engine                               â”‚ â”‚
â”‚ â”‚    â€¢ è¾“å…¥: .wav éŸ³é¢‘ + .lab ä¸­æ–‡æ–‡æœ¬                                 â”‚ â”‚
â”‚ â”‚    â€¢ å­—å…¸: æ±‰å­— â†’ éŸ³ç´ æ˜ å°„ (mandarin_china_mfa.dict)                 â”‚ â”‚
â”‚ â”‚    â€¢ å£°å­¦æ¨¡å‹: mandarin_mfa.zip                                      â”‚ â”‚
â”‚ â”‚    â€¢ è¾“å‡º: éŸ³ç´ çº§æ—¶é—´å¯¹é½çš„ TextGrid æ–‡ä»¶                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚ è¾“å‡º: bank/[éŸ³æºåç§°]/textgrid/                                         â”‚
â”‚       â”œâ”€â”€ test_0000.TextGrid                                            â”‚
â”‚       â””â”€â”€ test_0001.TextGrid                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: å¯¼å‡ºéŸ³æº (å¯¼å‡ºæ’ä»¶ç³»ç»Ÿ)                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç®€å•å•å­—å¯¼å‡ºæ’ä»¶ (SimpleExportPlugin)                                â”‚ â”‚
â”‚ â”‚    1. ä» TextGrid æå–æ¯ä¸ªæ±‰å­—çš„æ—¶é—´è¾¹ç•Œ                             â”‚ â”‚
â”‚ â”‚    2. å°†æ±‰å­—è½¬æ¢ä¸ºæ‹¼éŸ³ (pypinyin)                                    â”‚ â”‚
â”‚ â”‚    3. æŒ‰æ‹¼éŸ³åˆ†ç±»åˆ‡å‡ºéŸ³é¢‘ç‰‡æ®µ                                         â”‚ â”‚
â”‚ â”‚    4. æŒ‰æ—¶é•¿æ’åºï¼Œä¿ç•™æœ€ä½³æ ·æœ¬                                       â”‚ â”‚
â”‚ â”‚    5. æŒ‰å‘½åè§„åˆ™å¯¼å‡º (å¦‚: ba.wav, ba1.wav, ba2.wav)                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚ è¾“å‡º: export/[éŸ³æºåç§°]/simple_export/                                  â”‚
â”‚       â”œâ”€â”€ ba.wav                                                        â”‚
â”‚       â”œâ”€â”€ ba1.wav                                                       â”‚
â”‚       â”œâ”€â”€ ni.wav                                                        â”‚
â”‚       â””â”€â”€ ...                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¨¡å—è¯´æ˜

### 1. æ¨¡å‹ç®¡ç†æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Silero VAD ä¸‹è½½ | `silero_vad_downloader.py` | ä¸‹è½½è¯­éŸ³æ´»åŠ¨æ£€æµ‹æ¨¡å‹ |
| MFA æ¨¡å‹ä¸‹è½½ | `mfa_model_downloader.py` | ä¸‹è½½å£°å­¦æ¨¡å‹å’Œå­—å…¸ |
| Whisper æ¨¡å‹ | é€šè¿‡ HuggingFace è‡ªåŠ¨ä¸‹è½½ | è¯­éŸ³è¯†åˆ«æ¨¡å‹ |

æ”¯æŒçš„è¯­è¨€:
- ä¸­æ–‡ (æ™®é€šè¯): `mandarin_mfa.zip` + `mandarin_china_mfa.dict`
- æ—¥æ–‡: `japanese_mfa.zip` + `japanese_mfa.dict`

### 2. éŸ³é¢‘å¤„ç†æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| éŸ³é¢‘å¤„ç†å™¨ | `audio_processor.py` | VADåˆ‡ç‰‡ + Whisperè½¬å½•å°è£… |
| æ–‡æœ¬å¤„ç†å™¨ | `text_processor.py` | ä¸­æ–‡è½¬æ‹¼éŸ³ã€æ—¥æ–‡è½¬ç½—é©¬éŸ³ |

### 3. MFA å¯¹é½æ¨¡å—

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| MFA è¿è¡Œå™¨ | `mfa_runner.py` | è·¨å¹³å°è°ƒç”¨ MFA å¼•æ“ |

MFA æ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å¼:
- **Windows**: Sidecar Patternï¼Œé€šè¿‡ subprocess è°ƒç”¨ç‹¬ç«‹çš„ Python ç¯å¢ƒ (`tools/mfa_engine`)
- **Linux**: ç›´æ¥è°ƒç”¨ç³»ç»Ÿå®‰è£…çš„ `mfa` å‘½ä»¤ (pip install montreal-forced-aligner)

### 4. å¯¼å‡ºæ’ä»¶ç³»ç»Ÿ

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| æ’ä»¶åŸºç±» | `export_plugins/base.py` | å®šä¹‰æ’ä»¶æ¥å£å’Œé…ç½®é€‰é¡¹ |
| æ’ä»¶åŠ è½½å™¨ | `export_plugins/loader.py` | æ‰«æå’ŒåŠ è½½æ’ä»¶ |
| ç®€å•å¯¼å‡º | `export_plugins/simple_export.py` | æŒ‰æ‹¼éŸ³åˆ†ç±»å¯¼å‡ºå•å­—éŸ³é¢‘ |

æ’ä»¶é…ç½®é€‰é¡¹ç±»å‹:
- `TEXT`: æ–‡æœ¬è¾“å…¥
- `NUMBER`: æ•°å­—è¾“å…¥
- `SWITCH`: å¼€å…³
- `COMBO`: ä¸‹æ‹‰é€‰æ‹©
- `FILE`/`FOLDER`: æ–‡ä»¶/æ–‡ä»¶å¤¹é€‰æ‹©

### 5. MFA è·¨å¹³å°æ”¯æŒ

MFA æ”¯æŒä¸‰ç§è¿è¡Œæ¨¡å¼:
- **Windows (å¤–æŒ‚æ¨¡å¼)**: é€šè¿‡ subprocess è°ƒç”¨ç‹¬ç«‹çš„ Python ç¯å¢ƒ (`tools/mfa_engine`)
- **Linux (ç³»ç»Ÿå‘½ä»¤)**: ç›´æ¥è°ƒç”¨ç³»ç»Ÿ PATH ä¸­çš„ `mfa` å‘½ä»¤
- **Linux (Python æ¨¡å—)**: é€šè¿‡ `python -m montreal_forced_aligner` è°ƒç”¨

`mfa_runner.py` ä¼šè‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„è°ƒç”¨æ–¹å¼ï¼Œä¼˜å…ˆçº§:
1. ç³»ç»Ÿ `mfa` å‘½ä»¤ (shutil.which)
2. Python æ¨¡å—æ–¹å¼ (`sys.executable -m montreal_forced_aligner`)
3. Windows å¤–æŒ‚æ¨¡å¼ (`tools/mfa_engine/python.exe`)

## æ•°æ®æµ

```
åŸå§‹éŸ³é¢‘
    â”‚
    â”œâ”€â”€[VADåˆ‡ç‰‡]â”€â”€â†’ slices/*.wav (44.1kHz 16bit å•å£°é“)
    â”‚
    â”œâ”€â”€[Whisper]â”€â”€â†’ slices/*.lab (ä¸­æ–‡æ–‡æœ¬)
    â”‚
    â”œâ”€â”€[MFAå¯¹é½]â”€â”€â†’ textgrid/*.TextGrid (éŸ³ç´ çº§æ—¶é—´æ ‡æ³¨)
    â”‚
    â””â”€â”€[å¯¼å‡ºæ’ä»¶]â”€â”€â†’ export/[éŸ³æº]/[æ’ä»¶å]/*.wav (æŒ‰æ‹¼éŸ³åˆ†ç±»)
```

## å…ƒä¿¡æ¯æ–‡ä»¶

æ¯ä¸ªéŸ³æºç›®å½•åŒ…å« `meta.json` æ–‡ä»¶ï¼Œè®°å½•åˆ¶ä½œå‚æ•°:

```json
{
  "source_name": "my_voice",
  "created_at": "2026-01-31T10:00:00",
  "updated_at": "2026-01-31T12:00:00",
  "whisper_model": "openai/whisper-small",
  "mfa_dict": "mandarin_china_mfa.dict",
  "mfa_acoustic": "mandarin_mfa.zip",
  "language": "chinese",
  "single_speaker": true,
  "slice_count": 13,
  "textgrid_count": 13
}
```

## ä½¿ç”¨æµç¨‹

### æ–¹å¼ä¸€: æœ¬åœ° Web UI (Gradio)

1. è¿è¡Œ `python main.py` å¯åŠ¨ Web UI
2. æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ http://127.0.0.1:7860
3. åœ¨ã€ŒğŸ“¦ æ¨¡å‹ä¸‹è½½ã€é¡µä¸‹è½½æ‰€éœ€æ¨¡å‹:
   - Whisper è¯­éŸ³è¯†åˆ«æ¨¡å‹ (small/medium)
   - Silero VAD è¯­éŸ³æ´»åŠ¨æ£€æµ‹æ¨¡å‹
   - MFA å£°å­¦æ¨¡å‹å’Œå­—å…¸ (ä¸­æ–‡/æ—¥æ–‡)
4. åœ¨ã€ŒğŸµ åˆ¶ä½œéŸ³æºã€é¡µ:
   - è®¾ç½®éŸ³æºåç§°å’Œè½¬å½•è¯­è¨€
   - ä¸Šä¼ æˆ–è¾“å…¥éŸ³é¢‘æ–‡ä»¶è·¯å¾„
   - é€‰æ‹© Whisper æ¨¡å‹å’Œ MFA æ¨¡å‹
   - ç‚¹å‡»ã€Œä¸€é”®æ‰§è¡Œå…¨éƒ¨æµç¨‹ã€æˆ–åˆ†æ­¥æ‰§è¡Œ
5. åœ¨ã€ŒğŸ“¤ å¯¼å‡ºéŸ³æºã€é¡µ:
   - é€‰æ‹©å·²åˆ¶ä½œçš„éŸ³æº
   - é€‰æ‹©å¯¼å‡ºæ’ä»¶
   - é…ç½®å¯¼å‡ºé€‰é¡¹å¹¶æ‰§è¡Œ
   - ç‚¹å‡»ä¸‹è½½æŒ‰é’®è·å–ç»“æœ

> æ³¨: æ—§ç‰ˆ CustomTkinter æ¡Œé¢ GUI å·²ç§»è‡³ `src/gui_old.py`ï¼Œå¯é€šè¿‡ `python main_local.py` å¯åŠ¨

### æ–¹å¼äºŒ: æœ¬åœ°æ¡Œé¢ GUI (CustomTkinter)

1. è¿è¡Œ `python main_local.py` å¯åŠ¨æ¡Œé¢åº”ç”¨
2. ä½¿ç”¨åŸç”Ÿçª—å£ç•Œé¢æ“ä½œï¼ŒåŠŸèƒ½ä¸ Web UI ç›¸åŒ
3. é€‚åˆä¸éœ€è¦æµè§ˆå™¨çš„æœ¬åœ°ç‹¬ç«‹è¿è¡Œåœºæ™¯

### æ–¹å¼ä¸‰: äº‘ç«¯éƒ¨ç½² (HF Spaces / é­”å¡”ç¤¾åŒº)

1. ä½¿ç”¨ `app.py` ä½œä¸ºå…¥å£æ–‡ä»¶
2. äº‘ç«¯ç¯å¢ƒè‡ªåŠ¨å®‰è£… MFA å’Œä¸‹è½½æ¨¡å‹
3. å¤„ç†å®Œæˆåé€šè¿‡ä¸‹è½½æŒ‰é’®è·å–ç»“æœ (äº‘ç«¯æ•°æ®ä¸æŒä¹…)

æ”¯æŒçš„äº‘å¹³å°:
- Hugging Face Spaces (Gradio SDK)
- é­”å¡”ç¤¾åŒº ModelScope (æ¨èï¼Œå›½å†…è®¿é—®å¿«)

### æ–¹å¼å››: å‘½ä»¤è¡Œ/è„šæœ¬

```python
from src.pipeline import PipelineConfig, VoiceBankPipeline

config = PipelineConfig(
    source_name="my_voice",
    input_path="path/to/audio.wav",
    output_base_dir="bank",
    models_dir="models",
    whisper_model="openai/whisper-small",
    mfa_dict_path="models/mfa/mandarin_china_mfa.dict",
    mfa_model_path="models/mfa/mandarin_mfa.zip",
    language="chinese"
)

pipeline = VoiceBankPipeline(config, progress_callback=print)
success, msg = pipeline.run_make_pipeline()
```

## ä¾èµ–è¯´æ˜

æ ¸å¿ƒä¾èµ–:
- `gradio`: Web UI æ¡†æ¶ (6.2.0)
- `transformers`: Whisper æ¨¡å‹
- `silero-vad`: è¯­éŸ³æ´»åŠ¨æ£€æµ‹
- `textgrid`: TextGrid æ–‡ä»¶è§£æ
- `soundfile`: éŸ³é¢‘è¯»å†™
- `torchaudio`: éŸ³é¢‘é‡é‡‡æ ·
- `pypinyin`: ä¸­æ–‡è½¬æ‹¼éŸ³
- `pykakasi`: æ—¥æ–‡è½¬ç½—é©¬éŸ³ (å¯é€‰)

> æ³¨: æ—§ç‰ˆæ¡Œé¢ GUI ä½¿ç”¨ `customtkinter`ï¼Œä»£ç ä¿ç•™åœ¨ `src/gui_old.py`

MFA ç¯å¢ƒ:
- **Windows**: ç‹¬ç«‹æ‰“åŒ…åœ¨ `tools/mfa_engine/`ï¼ŒåŒ…å« Python 3.11 + montreal-forced-aligner
- **Linux**: é€šè¿‡ pip å®‰è£… `montreal-forced-aligner`

## äº‘ç«¯éƒ¨ç½²è¯´æ˜

### ç›®å½•ç»“æ„ (äº‘ç«¯)

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ app.py                  # äº‘ç«¯å…¥å£ (ä½¿ç”¨ gui_cloud.py)
â”œâ”€â”€ main.py                 # æœ¬åœ°å…¥å£ (ä½¿ç”¨ gui.py)
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ gui.py              # æœ¬åœ° Web UI (å®Œæ•´åŠŸèƒ½)
â”‚   â”œâ”€â”€ gui_cloud.py        # äº‘ç«¯ Web UI (ä¸Šä¼ â†’å¤„ç†â†’ä¸‹è½½)
â”‚   â”œâ”€â”€ gui_old.py          # æ—§ç‰ˆæ¡Œé¢ GUI (CustomTkinter)
â”‚   â”œâ”€â”€ mfa_runner.py       # è·¨å¹³å° MFA è°ƒç”¨
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### äº‘ç«¯ GUI ç‰¹ç‚¹ (gui_cloud.py)

- **åˆ¶ä½œéŸ³æº**: ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ â†’ VADåˆ‡ç‰‡ + Whisperè½¬å½• + MFAå¯¹é½ â†’ ä¸‹è½½éŸ³æºåŒ…
- **å¯¼å‡ºéŸ³æº**: ä¸Šä¼ éŸ³æºåŒ… â†’ é€‰æ‹©å¯¼å‡ºæ’ä»¶ â†’ ä¸‹è½½å¯¼å‡ºç»“æœ
- ä½¿ç”¨ä¸´æ—¶å·¥ä½œç©ºé—´ï¼Œå¤„ç†å®Œæˆåè‡ªåŠ¨æ¸…ç†
- æ— éœ€æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨

### å¹³å°å·®å¼‚

| åŠŸèƒ½ | æœ¬åœ° (Windows) | äº‘ç«¯ (Linux) |
|------|----------------|--------------|
| MFA è°ƒç”¨ | tools/mfa_engine å¤–æŒ‚ | ç³»ç»Ÿ mfa å‘½ä»¤ |
| æ•°æ®å­˜å‚¨ | æœ¬åœ°æŒä¹…åŒ– | ä¸´æ—¶ç›®å½•ï¼Œéœ€ä¸‹è½½ |
| GPU åŠ é€Ÿ | æœ¬åœ°æ˜¾å¡ | å–å†³äºå¹³å°é…ç½® |
| æ¨¡å‹ç¼“å­˜ | models/ ç›®å½• | é¦–æ¬¡è¿è¡Œè‡ªåŠ¨ä¸‹è½½ |

### é­”æ­åˆ›ç©ºé—´éƒ¨ç½²é…ç½®

éƒ¨ç½²é…ç½®æ–‡ä»¶ `ms_deploy.json`:
```json
{
  "sdk_type": "gradio",
  "sdk_version": "6.2.0",
  "resource_configuration": "platform/2v-cpu-16g-mem",
  "base_image": "ubuntu22.04-py311-torch2.3.1-modelscope1.31.0"
}
```

äº‘ç«¯ä¾èµ–æ–‡ä»¶ `requirements_cloud.txt`:
- ç§»é™¤ Windows ä¸“ç”¨ä¾èµ– (customtkinter)
- æ·»åŠ  `montreal-forced-aligner` (Linux pip å®‰è£…)
- ä¿æŒ gradio ç‰ˆæœ¬ä¸ sdk_version ä¸€è‡´
